<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Server Application</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../styles/style.css">
</head>

<body class="centered">
    <section id="team" class="pb-5 col-12">
        <div class="container">
            <h1 class="section-title">Server Application</h1>

            <!-- Buttons -->
            <div class="row">
                <div class="col-12">
                    <div class="image-flip">
                        <div class="mainflip">
                            <div class="card">
                                <div class="row card-body text-center">
                                    <div class="col-6 text-center">
                                        <button type="button" class="btn btn-primary btn-sm col-12 text-center"
                                            data-toggle="modal" data-target="#messagesModalCenter">
                                            <i class="fa fa-bars"></i>
                                        </button>
                                    </div>
                                    <div class="btn-group-toggle col-6 text-center" data-toggle="buttons">
                                        <label id="serverActiveStateLabel" class="btn btn-primary btn-sm col-12 text-center <% if (profile.active) { %>
                                                        active
                                                        <% } %>">
                                            <input id="serverActiveStateButton" type="checkbox" <% if (profile.active)
                                                { %>
                                            checked
                                            <% } %>
                                            autocomplete="off">Active
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="messagesModalCenter" tabindex="-1" role="dialog" aria-labelledby="messagesModalCenterTitle"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title centered" id="messagesModalCenterTitle">
                                    Messages
                                </h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-3">
                                        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist"
                                            aria-orientation="vertical">
                                            <% for (var i = 0; i < messages.titles.length; i++) { %>
                                            <% var classes = "nav-link" %>
                                            <% if (i == 0) { %>
                                            <% classes += " active" %>
                                            <% } %>
                                            <a class="<%= classes %>" id="v-pills-<%= i %>-tab" data-toggle="pill" href="#v-pills-<%= i %>"
                                                role="tab" aria-controls="v-pills-<%= i %>" aria-selected="true">
                                                <%= messages.titles[i] %>
                                            </a>
                                            <% } %>
                                        </div>
                                    </div>
                                    <div class="col-9">
                                        <div class="tab-content" id="v-pills-tabContent">
                                            <% for (var i = 0; i < messages.titles.length; i++) { %>
                                            <% var classes = "tab-pane fade" %>
                                            <% if (i == 0) { %>
                                            <% classes += " show active" %>
                                            <% } %>
                                            <div class="<%= classes %>" id="v-pills-<%= i %>" role="tabpanel"
                                                aria-labelledby="v-pills-<%= i %>-tab">
                                                <% if (messages.data[i].length > 0) { %>
                                                <pre><%- messages.data[i].reverse().map(entity => JSON.stringify(entity, null, 4).replace(/(?:\r\n|\r|\n)/g, "<br>")).join("<hr>") %></pre>
                                                <% } else { %>
                                                <pre>No values</pre>
                                                <% } %>
                                            </div>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ./Modal -->
            </div>

            <!-- Server -->
            <div class="row">
                <!-- Team member -->
                <div class="col-xs-12 col-sm-6 col-md-6">
                    <div class="image-flip">
                        <div class="mainflip">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h4 class="card-title">Server
                                        <button type="button" class="btn btn-primary btn-sm" data-toggle="modal"
                                            data-target="#serverModalCenter">
                                            <i class="fa fa-pencil"></i>
                                        </button>
                                    </h4>
                                    <p class="card-text">
                                        <b>ID</b>:
                                        <%= profile.backendId %>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal -->
                    <div class="modal fade" id="serverModalCenter" tabindex="-1" role="dialog" aria-labelledby="serverModalCenterTitle"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title centered" id="serverModalCenterTitle">
                                        Edit server settings
                                    </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="serverForm">
                                        <div class="form-group">
                                            <label for="serverID">Server ID</label>
                                            <input class="form-control" id="serverID" placeholder="Enter Server ID"
                                                value="<%= profile.backendId %>">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="saveServerForm">Save changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ./Modal -->
                </div>
                <!-- ./Team member -->

                <!-- Broker -->
                <!-- Team member -->
                <div class="col-xs-12 col-sm-6 col-md-6">
                    <div class="image-flip">
                        <div class="mainflip">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h4 class="card-title">Broker
                                        <button type="button" class="btn btn-primary btn-sm" data-toggle="modal"
                                            data-target="#brokerModalCenter">
                                            <i class="fa fa-pencil"></i>
                                        </button>
                                    </h4>
                                    <p class="card-text">
                                        <b>Host</b>:
                                        <%= profile.broker.host %>
                                        </br>
                                        <b>Port</b>:
                                        <%= profile.broker.port %>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal -->
                    <div class="modal fade" id="brokerModalCenter" tabindex="-1" role="dialog" aria-labelledby="brokerModalCenterTitle"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title modal-title-centered" id="brokerModalCenterTitle">
                                        Edit broker settings
                                    </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="brokerForm">
                                        <div class="form-group">
                                            <label for="brokerHost">Broker Host</label>
                                            <input class="form-control" id="brokerHost" placeholder="Host" value="<%= profile.broker.host %>">
                                            <label for="brokerPort">Broker Port</label>
                                            <input class="form-control" id="brokerPort" placeholder="Port" value="<%= profile.broker.port %>">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="saveBrokerForm">Save changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ./Modal -->
                </div>
                <!-- ./Team member -->
            </div>

            <!-- Device -->
            <% for (var i = 0; i < devices.length; i++) { %>
            <div class="row">
                <!-- Team member -->
                <div class="col-xs-12 col-sm-6 col-md-12">
                    <div class="mainflip">
                        <div class="card">
                            <div class="card-body text-center">
                                <h4 class="card-title">Device
                                </h4>
                                <p class="card-text">
                                    <b>ID</b>:
                                    <%= devices[i].id %>
                                    </br>
                                    <b>Name</b>:
                                    <%= devices[i].name %>
                                    </br>
                                    <b>Sensors</b>:
                                    <%= devices[i].sensors.length %>
                                    <% if (devices[i].actions.length > 0) { %>
                                    </br>
                                    <b>Actions</b>:
                                    <%= devices[i].actions.map(action => `[ID: ${action.id}, name: ${action.name}]`).join(", ") %>
                                    <% } %>
                                    </br>
                                    <b>Active</b>:
                                    <%= devices[i].active %>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ./Team member -->

            <!-- Sensors -->
            <% for (var j = 0; j < devices[i].sensors.length; j++) { %>
            <div class="row justify-content-end">
                <!-- Team member -->
                <div class="col-xs-11 col-sm-4 col-md-11">
                    <div class="mainflip">
                        <div class="card">
                            <div class="card-body text-center">
                                <h4 class="card-title">Sensor
                                </h4>
                                <p class="card-text">
                                    <b>ID</b>:
                                    <%= devices[i].sensors[j].id %>
                                    </br>
                                    <b>Type</b>:
                                    <%= devices[i].sensors[j].type %>
                                    <% if (devices[i].sensors[j].actions.length > 0) { %>
                                    </br>
                                    <b>Actions</b>:
                                    <%= devices[i].sensors[j].actions.map(action => `[ID: ${action.id}, name: ${action.name}]`).join(", ") %>
                                    <% } %>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <% } %>
            <% } %>
        </div>
    </section>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script src="../frontend/server.edit.js"></script>
    <script src="../frontend/broker.edit.js"></script>
    <script src="../frontend/active.check.js"></script>
</body>

</html>